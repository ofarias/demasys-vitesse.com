{% extends 'base.html' %}
{% load i18n %}
{% load url from future %}
{% load bootstrap_pagination %}
{% load humanize %}

{% block title %}Solicitudes{% endblock %}
{% block content_title %} Registro de Solicitudes{% endblock %}
{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/bootstrap-datepicker/css/datepicker3.css"/>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/select2/select2.css"/>
{% endblock %}

{% block nav-sol2 %}<li class="active">{% endblock %}

{% block breadcrumb %}
<ul class="page-breadcrumb">
	<li>
		<i class="fa fa-home"></i>
		<a href="{% url 'dashboards.views.index' %}">Dashboard</a>	
		<i class="fa fa-angle-right"></i>					
	</li>
	<li>		
		<a href="#">Solicitudes</a>						
	</li>	
</ul>
{% endblock %}

{% block actions %}
{% endblock %}

{% block content %}
							<div class="modal fade" id="ajax" role="basic" aria-hidden="true">
								<div class="page-loading page-loading-boxed">
									<img src="{{MEDIA_URL}}img/loading-spinner-grey.gif" alt="" class="loading">
									<span>
									&nbsp;&nbsp;Cargando... </span>
								</div>
								<div class="modal-dialog">
									<div class="modal-content">
									</div>
								</div>
							</div>
							<div class="modal fade" id="ajax2" role="basic" aria-hidden="true">
								<div class="page-loading page-loading-boxed">
									<img src="{{MEDIA_URL}}img/loading-spinner-grey.gif" alt="" class="loading">
									<span>
									&nbsp;&nbsp;Cargando... </span>
								</div>
								<div class="modal-dialog">
									<div class="modal-content">
									</div>
								</div>
							</div>

							<div class="row">	
								<div class="col-md-12">
									<div class="portlet box grey-cascade">
										<div class="portlet-title">
											<div class="caption">
								Solicitudes
							</div>							
						</div>
						
						<div class="portlet-body">
                            <div class="table-toolbar">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="btn-group">
										{% if perms.solicitudes.add_solicitudes %}
										<a href="{% url 'solicitudes.views.agregar' %}" color=red; class="btn blue">
											Agregar Solicitud <i class="fa fa-plus"></i>
										</a>
										{% else %}
										<div class="alert alert-dismissable alert-danger">
											<button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
											{{user.get_short_name}} no tiene permisos para Agregar.<br/> Solicite permisos al administrador.
										</div>
										{% endif %}
										
                                </div>
                              </div>
                           </div>
                         </div>
                      </div>
                   </div>
							<div class="table-scrollable">
								<table class="table table-striped table-bordered table-hover" id="sample_1">
								<thead>
								<tr>
									<th>
										----Folio-----      
									</th>
									<th>
										 Solicita
									</th>
									<th>
										 Operador
									</th>
									<th>
										 Beneficiarios
									</th>
									<th>
										 Fecha de Solicitud
									</th>									
									<th>
										 ---Importe--- 
									</th>
									<th>
										 ---  Estatus  ---
									</th>
									<th>
										 Referencia
									</th>
									<th>
										 Carta Porte
									</th>
							
									<th>
										Concepto
									</th>
									<th>
										 Fecha de Aut/Rech
									</th>	
									<th>
										 Motivo de Rechazo
									</th>
									<th>
										Editar
									</th>
									<th>
										 Autorizar
									</th>
									<th>
										 Asignar
									</th>																	
								</tr>
								<form action="" id="search-form" method="get">
								<tr role="row" class="filter">									
									<td>
										{{searchform.pk}}
									</td>
									<td>
										{{searchform.solicitante}}
									</td>
									<td>
										{{searchform.beneficiario}}
									</td>
									<td>
										{{searchform.benef_otros}}
									</td>
									<td>
										<div class="input-group date date-picker margin-bottom-5" data-date-format="yyyy-mm-dd">
											{{searchform.fecha}}
											<span class="input-group-btn">
											<button class="btn btn-sm default" type="button"><i class="fa fa-calendar"></i></button>
											</span>
										</div>																		
									</td>
									<td>
										{{searchform.importe_asig}}
									</td>
									<td>
										{{searchform.status}}
									</td>
									<td>										
										{{searchform.refer}}										
									</td>
									<td>
										{{searchform.sol_bill}}
									</td>
								
									<td>
										{{searchform.concepts}}
									</td>
									<td>
											<div class="input-group date date-picker margin-bottom-5" data-date-format="yyyy-mm-dd">
											{{searchform.fecha_aut}}
											<span class="input-group-btn">
											<button class="btn btn-sm default" type="button"><i class="fa fa-calendar"></i></button>
											</span>
										</div>									
									</td>
									<td>
										{{searchform.motivo_rech}}
									</td>
								
									<td>
										{{searchform.operador}}
									</td>
									<td>
										{{searchform.opera}}
									</td>
									<td>
										<div class="margin-bottom-5">
											<button type="submit" class="btn btn-sm blue filter-submit margin-bottom"><i class="fa fa-search"></i> Buscar</button>
										</div>
										
									</td>
								</thead>
								<tbody>
								{% for Solicitudes in solics %}  <!-- Solicitudes es la class definida en Models y solics es definido aqui miso -->
								<tr class="odd gradeX {{Solicitudes.cancelado}} {{Solicitudes.get_status_display}}"> <!-- se agrega la calse para el color como Solicitudes get status display y despues de agrega la condicion en components -->
								
									<td>
										{{Solicitudes.pk}}
									</td>
									<td>
										{{Solicitudes.solicitante}}  <!-- nombre del modelo en models.py + nombre del campo -->
									</td>
									<td>
										{{Solicitudes.beneficiario}}
									</td>
									<td>
										{{Solicitudes.benef_otros}}
									</td>
									<td>
										{{Solicitudes.fecha}}
									</td>									
									<td>
										$ {{Solicitudes.importe_asig|intcomma}}
									</td>
									<td>
										 {{Solicitudes.get_status_display}}
									</td>
									<td>
										 {{Solicitudes.refer}}
									</td>
									<td>
										 {{Solicitudes.sol_bill}}
									</td>
						
									<td>
										{{Solicitudes.concepts}}
									</td>
									<td>
										{{Solicitudes.fecha_aut}}
									</td>
									<td>
										{{Solicitudes.motivo_rech}}
									</td>
							
									 <td>
											{% if perms.solicitudes.change_solicitudes %}
											<a href="{% url 'solicitudes.views.edit' Solicitudes.pk %}" class="btn default btn-xs blue-stripe">Editar</a>
											{% else %}
											<div class="alert alert-dismissable alert-danger">
												<button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
												{{user.get_short_name}} no tiene permisos para Editar.<br/> Solicite permisos al administrador.
											</div>
											{% endif %}
							
											
											</td>

<td>
											{% if perms.solicitudes.change_solicitudes and user.get_username == 'alejandro.macias' %}
												<a href="{% url 'solicitudes.views.editar' Solicitudes.pk %}" class="btn default btn-xs blue-stripe">Autorizar</a>
											{% else %}
											<div class="alert alert-dismissable alert-danger">
												<button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
												Sin permisos para Autorizar.
											</div>
											{% endif %}
											</td>





											<td>
											{% if user.get_username == 'mara.dominguez' or user.get_username == 'ivonne.teran' or user.get_username == 'Cinthia' or user.get_username == 'alejandro.macias' %}	
											{% if perms.solicitudes.change_solicitudes %}	
												<a href="{% url 'solicitudes.views.asignar' Solicitudes.pk %}" class="btn default btn-xs blue-stripe">Asignar</a>
											{% else %}
											<div class="alert alert-dismissable alert-danger">
												<button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
												Sin permisos para Asignar.
											</div>
											{% endif %}
											{% else %}
											<div class="alert alert-dismissable alert-danger">
												<button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
												{{user.get_short_name}} no tiene permisos para Asignar.

											{% endif %}

											</td>

											



																
								</tr>
								{% empty %}
								<tr>
									<td colspan="6" class="center">No se encontrar√≥n datos.</td>
								</tr>
								{% endfor %}							
								</tbody>
								</table>
								{% bootstrap_paginate solics %} <!-- "solics" debe estar dado de alta en views.py -->
							</div>
						</div>
					</div>					
            </div>
         </div>
{% endblock %}

{% block extra_script %}
<script type="text/javascript" src="{{MEDIA_URL}}plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}plugins/select2/select2.js"></script>
{% endblock %}

{% block script_ready %}
	$('body').on('hidden.bs.modal', '.modal', function () {
  		$(this).removeData('bs.modal');
	});
	
	$('.date-picker').datepicker({
        rtl: Metronic.isRTL(),
        orientation: "auto",
        autoclose: true        
    });
{% endblock %}
