{% extends 'base.html' %}
{% load i18n %}
{% load url from future %}
{% load sepomex_filters %}

{% block title %}Dashboard{% endblock %}
{% block content_title %} Dashboard {% endblock %}

{% block extra_head %}
<link href="{{MEDIA_URL}}plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
<link href="{{MEDIA_URL}}plugins/fullcalendar/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block actions %}
<div class="page-toolbar">
	<div id="dashboard-report-range" class="pull-right tooltips btn btn-fit-height grey-salt" data-placement="top" data-original-title="Cambiar rango de fechas">
		<i class="icon-calendar"></i>&nbsp; <span class="thin uppercase visible-lg-inline-block"></span>&nbsp; <i class="fa fa-angle-down"></i>
	</div>
</div>
{% endblock %}

{% block nav-dashboard %}<li class="start active">{% endblock %}

{% block content %}
		<div class="row">
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat blue-madison">
						<div class="visual">
							<i class="fa fa-file"></i>
						</div>
						<div class="details">
							<div class="number">
								 {{nuevas}}
							</div>
							<div class="desc">
								 Nuevas Solicitudes
							</div>
						</div>
						<a class="more" href="{% url 'viajes.views.index' %}?status=1&fecha_from=&fecha_to=">
						Consultar <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat red-intense">
						<div class="visual">
							<i class="fa fa-check-square"></i>
						</div>
						<div class="details">
							<div class="number">
								 {{autorizadas}}
							</div>
							<div class="desc">
								 Solicitudes Autorizadas
							</div>
						</div>
						<a class="more" href="{% url 'viajes.views.index' %}?status=2&fecha_from=&fecha_to=">
						Consultar <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat green-haze">
						<div class="visual">
							<i class="fa fa-truck"></i>
						</div>
						<div class="details">
							<div class="number">
								 {{enruta}}
							</div>
							<div class="desc">
								 En Ruta
							</div>
						</div>
						<a class="more" href="{% url 'viajes.views.index' %}?status=3&fecha_from=&fecha_to=">
						Consultar <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat purple-plum">
						<div class="visual">
							<i class="fa fa-money"></i>
						</div>
						<div class="details">
							<div class="number">
								 {{facturacion}}
							</div>
							<div class="desc">
								 En Facturaci√≥n
							</div>
						</div>
						<a class="more" href="{% url 'viajes.views.index' %}?status=7&fecha_from=&fecha_to=">
						Consultar <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>

         </div>
         <div class="clearfix">
			</div>
         <div class="row">
				<div class="col-md-12 col-sm-12">
					<!-- BEGIN PORTLET-->
					<div class="portlet light bg-inverse">
						<div class="portlet-title">
							<div class="caption">
								<i class="icon-bar-chart font-green-sharp"></i>
								<span class="caption-subject font-green-sharp ">Destinos</span>
								<span class="caption-helper">General</span>
							</div>
							<div class="actions">
								<div class="btn-group btn-group-devided" data-toggle="buttons">
									<label class="btn btn-transparent grey-salsa btn-circle btn-sm active">
									<input type="radio" name="options" class="toggle" id="option1">Todos</label>
									<label class="btn btn-transparent grey-salsa btn-circle btn-sm">
									<input type="radio" name="options" class="toggle" id="option2">Samsung</label>
									<label class="btn btn-transparent grey-salsa btn-circle btn-sm">
									<input type="radio" name="options" class="toggle" id="option3">LG</label>
								</div>
							</div>
						</div>
						<div class="portlet-body">
							<div id="site_statistics_content">
								<div id="chart_destinos" class="chart" style="width: 100%">
									
								</div>
							</div>
						</div>
					</div>
					<!-- END PORTLET-->
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 col-sm-12">
					<!-- BEGIN PORTLET-->
					<div class="portlet light bg-inverse">
						<div class="portlet-title">
							<div class="caption">
								<i class="icon-share font-red-sunglo"></i>
								<span class="caption-subject font-red-sunglo ">Economicos</span>
								<span class="caption-helper">viajes...</span>
							</div>
							<div class="actions">								
							</div>
						</div>
						<div class="portlet-body">							
							<div id="site_activities_content">
								<div id="site_activities" style="height: 228px;">
								</div>
							</div>							
						</div>
					</div>
					<!-- END PORTLET-->
				</div>
			</div>
			<div class="row">
				<div class="col-md-6">
					<div class="portlet light bg-inverse">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-dashboard"></i>
								<span class="caption-subject font-yellow-sunglo ">Status general</span>
							</div>							
						</div>
						<div class="portlet-body">
							<h4></h4>
							<div id="pie_chart_status" class="chart">
							</div>
						</div>
					</div>
				</div>
				{% if request.user.is_superuser %}
				<div class="col-md-6">				
					<div class="portlet light bg-inverse">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-file-excel-o"></i>
								<span class="caption-subject font-red-sunglo ">Reporte mensual</span>
							</div>
							
						</div>
						<div class="portlet-body">
							<div class="scroller" style="height: 300px;" data-always-visible="1" data-rail-visible="0">								
								<ul class="feeds">
									{% for rdate in dates_range %}
									<li>
										<a href="{% url 'dashboards.views.reporte' rdate.year rdate.month %}" target="_blank">
										<div class="col1">
											<div class="cont">
												<div class="cont-col1">
													<div class="label label-sm label-success">
														<i class="fa fa-bar-chart-o"></i>
													</div>
												</div>
												<div class="cont-col2">
													<div class="desc">
														{{rdate|date:"F Y"}}
													</div>
												</div>
											</div>
										</div>
										<div class="col2">
											<div class="date">
												 
											</div>
										</div>
										</a>
									</li>
									{% endfor %}									
								</ul>
							</div>

						</div>
					</div>
				</div>
				{% endif %}
			</div>

{% endblock %}

{% block extra_script %}
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.min.js"></script>
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.resize.min.js"></script>
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.pie.min.js"></script>
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.stack.min.js"></script>
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.crosshair.min.js"></script>
<script src="{{MEDIA_URL}}plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
{% endblock %}

<script>
	{% block script_ready %}
	//Metronic.addResizeHandler(function () {
    //     Charts.initPieCharts(); 
    //});
    
    var data_destinos = [
    	{% for destino in destinos %}
			['{{destino.destino_clave_municipio|municipio}}', {{destino.num_visitas}}]{% if not forloop.last	%}, {% endif %}
		{% endfor %}    
    ];
    
    var data_economicos = [
    	{% for economico in economicos %}
			['{{economico.economico__placas}}', {{economico.num_viajes}}]{% if not forloop.last	%}, {% endif %}
		{% endfor %}    
    ];
    
    var options = {
                    series:{
                        bars:{show: true}
                    },
                    bars:{
                        horizontal:true,
                        barWidth:6,
                                    lineWidth: 0, // in pixels
                                    shadowSize: 0,
                                    align: 'left'
                    },
                    grid:{
                         tickColor: "#eee",
                                borderColor: "#eee",
                                borderWidth: 1
                    }
            };
            
    $.plot($("#chart_destinos"),[{
                        data: data_destinos,
                        lines: {
                            fill: 0.6,
                            lineWidth: 0
                        },
                        color: ['#f89f9f']
                    }, {
                        data: data_destinos,
                        points: {
                            show: true,
                            fill: true,
                            radius: 5,
                            fillColor: "#f89f9f",
                            lineWidth: 3
                        },
                        color: '#fff',
                        shadowSize: 0
                    }],

                    {
                        xaxis: {
                            tickLength: 0,
                            tickDecimals: 0,
                            mode: "categories",
                            min: 0,
                            font: {
                                lineHeight: 14,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        yaxis: {
                            ticks: 5,
                            tickDecimals: 0,
                            tickColor: "#eee",
                            font: {
                                lineHeight: 14,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        grid: {
                            hoverable: true,
                            clickable: true,
                            tickColor: "#eee",
                            borderColor: "#eee",
                            borderWidth: 1
                        }
                    }); 
                    
	$.plot($("#site_activities"),

                    [{
                        data: data_economicos,
                        lines: {
                            fill: 0.2,
                            lineWidth: 0,
                        },
                        color: ['#BAD9F5']
                    }, {
                        data: data_economicos,
                        points: {
                            show: true,
                            fill: true,
                            radius: 4,
                            fillColor: "#9ACAE6",
                            lineWidth: 2
                        },
                        color: '#9ACAE6',
                        shadowSize: 1
                    }, {
                        data: data_economicos,
                        lines: {
                            show: true,
                            fill: false,
                            lineWidth: 3
                        },
                        color: '#9ACAE6',
                        shadowSize: 0
                    }],

                    {

                        xaxis: {
                            tickLength: 0,
                            tickDecimals: 0,
                            mode: "categories",
                            min: 0,
                            font: {
                                lineHeight: 18,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        yaxis: {
                            ticks: 5,
                            tickDecimals: 0,
                            tickColor: "#eee",
                            font: {
                                lineHeight: 14,
                                style: "normal",
                                variant: "small-caps",
                                color: "#6F7B8A"
                            }
                        },
                        grid: {
                            hoverable: true,
                            clickable: true,
                            tickColor: "#eee",
                            borderColor: "#eee",
                            borderWidth: 1
                        }
                    });      
	var allstatus = {{all_status|safe}};                    
    $.plot($("#pie_chart_status"), allstatus, {
                    series: {
                        pie: {
                            show: true
                        }
                    }
                });                            
    
	{% endblock %}
</script>
