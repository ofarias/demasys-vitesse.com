{% extends 'base.html' %}
{% load i18n %}
{% load i18n humanize %}
{% load sepomex_filters %}
{% load url from future %}

{% block title %}Viajes{% endblock %}
{% block content_title %} Solicitudes de viaje {% endblock %}

{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/bootstrap-datepicker/css/datepicker3.css"/>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/select2/select2.css"/>
{% endblock %}

{% block nav-viajes %}<li class="active">{% endblock %}

{% block breadcrumb %}
<ul class="page-breadcrumb">
	<li>
		<i class="fa fa-home"></i>
		<a href="{% url 'dashboards.views.index' %}">Dashboard</a>	
		<i class="fa fa-angle-right"></i>					
	</li>
	<li>		
		<a href="#">Solicitudes de viaje</a>
	</li>	
</ul>
{% endblock %}

{% block actions %}
{% endblock %}

{% block content %}	
<form class="form-horizontal form-row-seperated" role="form" action="" method="post" id="statusform" enctype="multipart/form-data">
	{% csrf_token %}
	{{ formset_solicitudes.management_form }}

<!-- /////////////////////////////////////////////////////////////////////////////-->




		<div class="row">		
			<div class="col-md-12">
				<div class="portlet light form-fit">				
					<div class="portlet-body form">					
						<h3 class="form-section">Solicitudes de viajes</h3>
						<div class="table-toolbar">
							<div class="row">
								<div class="col-md-6">
									<div class="btn-group">
										<button id="btn_add_solicitudes" class="btn green">
											Agregar Solicitud <i class="fa fa-plus"></i>
										</button>
									</div>
								</div>
								<div class="col-md-6">
								</div>
							</div>
						</div>
						<div class="table-responsive">		
							<table class="table table-striped table-hover table-bordered" id="solicitudes_table">
								<thead>
									<tr>
										<th>
											Cliente
										</th>
										<th>
											Departamento
										</th>
										<th>
											Ecónomico
										</th>
										<th>
											Operador
										</th>
										<th>
											Ruta
										</th>
										<th>
											Tipo Ruta
										</th>
										<th>
											Contiene
										</th>
										<th>
											Referencia
										</th>
										<th>
											Fecha salida
										</th>
										<th>
											Municipio
										</th>
										<th>
											Colonia
										</th>
										<th>
											Calle
										</th>
										<th>
											Número
										</th>
										<th>
											C.P.
										</th>
										<th>
											Observaciones
										</th>
										<th>
											Estatus
										</th>

										<th>
											Borrar
										</th>
									</tr>

								</thead>
								<tbody>
									{% for form in formset_solicitudes %}
									<tr class="tr_form_ap">
										<td>
											{{ form.id }}
											{{ form.cliente }}
											{% if form.cliente.errors %}<span class="help-block">{{form.cliente.errors}}</span>{% endif %}
										</td>
										<td>
											{{ form.departamento }}
											{% if form.departamento.errors %}<span class="help-block">{{form.departamento.errors}}</span>{% endif %}
										</td>
										<td class="text-right">
											{{form.economico}}
											{% if form.economico.errors %}<span class="help-block">{{form.economico.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.operador }}
											{% if form.operador.errors %}<span class="help-block">{{form.operador.errors}}</span>{% endif %}
										</td>

										<td style=" text-align:left;">
											{{ form.ruta }}
											{% if form.ruta.errors %}<span class="help-block">{{form.ruta.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.tipo_ruta }}
											{% if form.tipo_ruta.errors %}<span class="help-block">{{form.tipo_ruta.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.contiene }}
											{% if form.contiene.errors %}<span class="help-block">{{form.contiene.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.referencia }}
											{% if form.referencia.errors %}<span class="help-block">{{form.referencia.errors}}</span>{% endif %}
										</td>
										<td >
											<div class="input-group date date-picker">
											{{ form.fecha_salida }}
											{% if form.fecha_salida.errors %}<span class="help-block">{{form.fecha_salida.errors}}</span>{% endif %}
												<span class="input-group-btn">
													<button class="btn blue" type="button">
														<i class="fa fa-calendar"></i>
													</button>
												</span>
											</div>
										</td>
										<td style=" text-align:left;">
											{{ form.origen_clave_municipio }}
											{% if form.origen_clave_municipio.errors %}<span class="help-block">{{form.origen_clave_municipio.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.origen_colonia }}
											{% if form.origen_colonia.errors %}<span class="help-block">{{form.origen_colonia.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.origen_calle }}
											{% if form.origen_calle.errors %}<span class="help-block">{{form.origen_calle.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.origen_numero }}
											{% if form.origen_numero.errors %}<span class="help-block">{{form.origen_numero.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.origen_cp }}
											{% if form.origen_cp.errors %}<span class="help-block">{{form.origen_cp.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.observaciones }}
											{% if form.observaciones.errors %}<span class="help-block">{{form.observaciones.errors}}</span>{% endif %}
										</td>
										<td style=" text-align:left;">
											{{ form.estatus }}
											{% if form.estatus.errors %}<span class="help-block">{{form.estatus.errors}}</span>{% endif %}
										</td>


										<td>
											Borrar
											<a class="delete" href="javascript:;">
												{{ form.DELETE }}
												 </a>
											</td>
										</tr>	
										{% endfor %}							
									</tbody>
								</table>
							</div>

								


							</div>
						</div>
					</div>
				</div>
				<div class="form-actions">
					<div class="row">
						<div class="col-md-offset-3 col-md-9">
							<a href="{% url 'viajes.views.index' %}" class="btn default">
								Regresar
							</a>

							<button type="submit" name="status" value="" class="btn blue"  >
								Guardar
							</button>

						
						</div>
					</div>
				</div>
			</form>
			{% endblock %}

			{% block extra_script %}
			<script type="text/javascript" src="{{MEDIA_URL}}plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
			<script type="text/javascript" src="{{MEDIA_URL}}plugins/select2/select2.js"></script>
			<script src="{{MEDIA_URL}}plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
			<script src="{{MEDIA_URL}}scripts/jquery.number.min.js" type="text/javascript"></script>
			{% endblock %}

			{% block script_ready %}
////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////




$('.date-picker').datepicker({
rtl: Metronic.isRTL(),
orientation: "auto",
autoclose: true        
});


	$('#btn_add_solicitudes').live("click", function(e){
		e.preventDefault();
		var index_solicitudes = parseInt($('#id_solicitudes-TOTAL_FORMS').val());
		var max_solicitudes = parseInt($('#id_solicitudes-MAX_NUM_FORMS').val());
		alert(index_solicitudes + ' - ' + max_solicitudes);

		if(index_solicitudes < max_solicitudes){
			$('#solicitudes_table').append(
				$('#solicitudes_table .tr_form_ap:first')
				.clone(false, true)
				.find('input[name="solicitudes-0-id"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-id')
				.attr('name', 'solicitudes-'+index_solicitudes+'-id')
				.val('')
				.end()
				.find('select[name="solicitudes-0-cliente"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-cliente')
				.attr('name', 'solicitudes-'+index_solicitudes+'-cliente')
				.val('')
				.end()
				.find('select[name="solicitudes-0-departamento"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-departamento')
				.attr('name', 'solicitudes-'+index_solicitudes+'-departamento')
				.val('')
				.end()
				.find('select[name="solicitudes-0-economico"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-economico')
				.attr('name', 'solicitudes-'+index_solicitudes+'-economico')
				.val('')
				.end()
				.find('select[name="solicitudes-0-operador"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-operador')
				.attr('name', 'solicitudes-'+index_solicitudes+'-operador')
				.val('')
				.end()
				.find('select[name="solicitudes-0-tipo_ruta"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-tipo_ruta')
				.attr('name', 'solicitudes-'+index_solicitudes+'-tipo_ruta')
				.val('')
				.end()
				.find('input[name="solicitudes-0-contiene"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-contiene')
				.attr('name', 'solicitudes-'+index_solicitudes+'-contiene')
				.val('')
				.end()
				.find('input[name="solicitudes-0-referencia"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-referencia')
				.attr('name', 'solicitudes-'+index_solicitudes+'-referencia')
				.val('')
				.end()
				.find('input[name="solicitudes-0-fecha_salida"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-fecha_salida')
				.attr('name', 'solicitudes-'+index_solicitudes+'-fecha_salida')
				.val('')
				.end()
				.find('input[name="solicitudes-0-origen_clave_municipio"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-origen_clave_municipio')
				.attr('name', 'solicitudes-'+index_solicitudes+'-origen_clave_municipio')
				.val('')
				.end()
				.find('input[name="solicitudes-0-origen_colonia"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-origen_colonia')
				.attr('name', 'solicitudes-'+index_solicitudes+'-origen_colonia')
				.val('')
				.end()
				.find('input[name="solicitudes-0-origen_calle"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-origen_calle')
				.attr('name', 'solicitudes-'+index_solicitudes+'-origen_calle')
				.val('')
				.end()
				.find('input[name="solicitudes-0-origen_numero"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-origen_numero')
				.attr('name', 'solicitudes-'+index_solicitudes+'-origen_numero')
				.val('')
				.end()
				.find('input[name="solicitudes-0-origen_cp"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-origen_cp')
				.attr('name', 'solicitudes-'+index_solicitudes+'-origen_cp')
				.val('')
				.end()
				.find('textarea[name="solicitudes-0-observaciones"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-observaciones')
				.attr('name', 'solicitudes-'+index_solicitudes+'-observaciones')
				.val('')
				.end()
				.find('select[name="solicitudes-0-estatus"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-estatus')
				.attr('name', 'solicitudes-'+index_solicitudes+'-estatus')
				.val('')
				.end()
				.find('input[name="solicitudes-0-DELETE"]')
				.attr('id','id_solicitudes-'+index_solicitudes+'-DELETE')
				.attr('name', 'solicitudes-'+index_solicitudes+'-DELETE')
				.attr('checked', false)
				.end()
			);
			index_solicitudes++;
			$('#id_solicitudes-TOTAL_FORMS').val(index_solicitudes);
		} else {
			alert('Ha alcanzado el máximo de solicitudes.');
		}

	});

	$('.delete').live("click", function(){
		alert('¿Seguro?');
		$(this).siblings('input').val(1);
		$(this).parent().parent().slideUp('slow');
	});

	$('#statusform').submit(function(event){
	});


{% endblock %}
