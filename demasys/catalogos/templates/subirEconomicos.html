{% extends 'base.html' %}
{% load i18n %}
{% load sepomex_filters %}
{% load url from future %}
{% load bootstrap_pagination %}

{% block title %}Subir Exel{% endblock %}
{% block content_title %} Subir Archivo Exel Económicos{% endblock %}

{% block extra_head %}
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/bootstrap-datepicker/css/datepicker3.css"/>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/select2/select2.css"/>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}plugins/jquery-multi-select/css/multi-select.css"/>

{% endblock %}

{% block nav-factEco %}<li class="active">{% endblock %}

{% block breadcrumb %}
<ul class="page-breadcrumb">
    <li>
        <i class="fa fa-home"></i>
        <a href="{% url 'dashboards.views.index' %}">Dashboard</a>    
        <i class="fa fa-angle-right"></i>                    
    </li>
    <i class="icon-rocket"></i>
    <li>        
        Catalogos
        <i class="fa fa-angle-right"></i>                        
    </li>
    <li>        
        Subir Excel Económicos                        
    </li>    
</ul>
{% endblock %}

{% block actions %}
{% endblock %}

{% block content %}
		<div class="modal fade" id="history" role="basic" aria-hidden="true">
			<div class="page-loading page-loading-boxed">
				<img src="{{MEDIA_URL}}img/loading-spinner-grey.gif" alt="" class="loading">
				<span>
				&nbsp;&nbsp;Cargando... </span>
			</div>
			<div class="modal-dialog">
				<div class="modal-content">
				</div>
			</div>
		</div>
		<div class="portlet light bg-inverse">
			<div class="portlet-title">
				<div class="caption">
					<i class="icon-equalizer font-blue"></i>
					<span class="caption-subject font-blue bold uppercase">
						Seleccione su archivo de Excel Económicos</span>
					<span class="caption-helper"></span>
				</div>
				<div class="actions">
					
				</div>
			</div>
			<div class="portlet-body form">
	

                <form  action="{% url 'catalogos.views.ExcelEconomicoView' %}" method="post" enctype="multipart/form-data">{% csrf_token %}


					<div class="form-body">						
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">

									<!--<h3 class="form-section">Seleccione</h3>					
									<button class="btn blue" id="restore-btn"><i class="fa fa-upload"></i> Cargar</button>-->

<div style="position:relative;">
		<a class='btn btn-primary' href='javascript:;'>
		<span class="glyphicon glyphicon-paperclip">&nbsp;</span>	Selecione archivo
			<input type="file" style='position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;' name="docfile" 
			size="40"  onchange='$("#upload-file-info").html($(this).val());'>
		</a>
		&nbsp;&nbsp;&nbsp;
		<span class='label label-info' id="upload-file-info"></span>
	</div>
	<hr>
	<br/><br/>






    <button type="submit" class="btn green" id="export-btn" name="submit" size="40"> <i class="glyphicon glyphicon-arrow-up">&nbsp;&nbsp;</i>&nbsp;&nbsp; Subir Excel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>						

								</div>
							</div>
							
						</div>						
					</div>
					

				</form>

    



				<!-- END FORM-->
			</div>
		</div>
		
		<div class="row">
			<div class="col-md-12">					
					<div class="portlet">										
						<div class="portlet-body">										
							<div class="table-responsive" id="search-results">				
								
							</div>
						</div>
					</div>
				</div>								
			</div>

{% endblock %}

{% block extra_script %}
<script type="text/javascript" src="{{MEDIA_URL}}plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}plugins/select2/select2.js"></script>
<script src="{{MEDIA_URL}}plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<script type="text/javascript" src="{{MEDIA_URL}}plugins/jquery-multi-select/js/jquery.multi-select.js"></script>
{% endblock %}


{% block script_ready %}
	$('#search-btn').on('click', function(e){
		e.preventDefault();		
		var form = $('#form-reports');
		$.ajax({
			url: '{% url 'viajes.views.reportesresults' %}',
			type: 'POST',
			dataType: 'HTML',
			data: form.serialize(),
			success: function(data){
				$('#search-results').html(data);
			}
		});
	});
	
	$('.date-picker').datepicker({
        rtl: Metronic.isRTL(),
        orientation: "auto",
        autoclose: true        
    });
    
    function sepomexFormatResult(municipio) {            
    	return municipio.municipio+', '+municipio.estado;
    }

    function sepomexFormatSelection(municipio) {
        return municipio.municipio;
    }
    
    $('.select2').select2();
    
    $('#id_campos').multiSelect();
    
    $("#id_destino").select2({    	
    	minimumInputLength: 2,
    	allowClear: true,
        ajax: {   
        	url: '{% url 'sepomex.views.direccion' %}',
        	dataType: 'json',
                data: function(term, page) {

                    return {
                        term: term
                    };
                },
                results: function(data, page) {
                    return {
                        results: data
                    };
            }
        },
        initSelection: function(element, callback) {
	        var ids = $(element).val();	        
	        if (ids!=="") {
	            $.ajax("{% url 'sepomex.views.direccion_recupera_unico' %}", {
	                data: {
	                    ids: ids
	                },
	                dataType: "json"
	            }).done(function(data) { callback(data); });
	        }
	    },
		formatResult: sepomexFormatResult, // omitted for brevity, see the source of this page
        formatSelection: sepomexFormatSelection, // omitted for brevity, see the source of this page   	
	});			
{% endblock %}